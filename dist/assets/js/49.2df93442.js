(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{309:function(v,_,t){"use strict";t.r(_);var a=t(0),e=Object(a.a)({},function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("p",[v._v("欢迎回来！ 😄")]),v._v(" "),t("p",[v._v("这里是每日练题系列。")]),v._v(" "),t("p",[v._v("这个系列会先分享昨天问题的答案并提出新的问题。")]),v._v(" "),t("h2",{attrs:{id:"回顾上期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回顾上期","aria-hidden":"true"}},[v._v("#")]),v._v(" 回顾上期")]),v._v(" "),t("p",[v._v("上期我们提出的问题是：")]),v._v(" "),t("p",[v._v("⭐️ "),t("strong",[v._v("请你谈谈 V8 执行 JavaScript 代码的流程")])]),v._v(" "),t("h2",{attrs:{id:"答案公布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#答案公布","aria-hidden":"true"}},[v._v("#")]),v._v(" 答案公布")]),v._v(" "),t("p",[v._v("在问题开始之前，")]),v._v(" "),t("p",[v._v("我们先来看看 V8 引擎的整体工作流程：")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://blog-img-1252360401.cos.ap-guangzhou.myqcloud.com/20191209-1.png",alt:"V8工作流程"}})]),v._v(" "),t("h3",{attrs:{id:"v8-解释流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v8-解释流程","aria-hidden":"true"}},[v._v("#")]),v._v(" V8 解释流程 🎏")]),v._v(" "),t("p",[v._v("从动态语言到可执行代码，")]),v._v(" "),t("p",[v._v("V8 为我们做了以下几个步骤的操作：")]),v._v(" "),t("ul",[t("li",[v._v("⭐️ 分词/词法分析：将一连串的字符打断成为有意义的字段，文档中称之为 token")]),v._v(" "),t("li",[v._v("⭐️ 解析：将解析出的 token 流转换成一个嵌套的树，也就是抽象语法树（AST）")]),v._v(" "),t("li",[v._v("⭐️ 代码生成：通过 AST 转换成指定平台的代码")])]),v._v(" "),t("p",[v._v("下面我们来一一说明这几个步骤：")]),v._v(" "),t("h3",{attrs:{id:"词法分析-解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#词法分析-解析","aria-hidden":"true"}},[v._v("#")]),v._v(" 词法分析 & 解析 🎏")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://blog-img-1252360401.cos.ap-guangzhou.myqcloud.com/20191209-2.jpg",alt:"词法分析"}})]),v._v(" "),t("p",[v._v("所谓的词法分析，")]),v._v(" "),t("p",[v._v("对应着的是如何将我们的代码拆解为我们的统一结构。")]),v._v(" "),t("p",[v._v("无论是写的什么逻辑，")]),v._v(" "),t("p",[v._v("最后都会成为抽象语法树上的一个分支，")]),v._v(" "),t("p",[v._v("统一的树结构为我们编译成不同平台的代码提供了可能。")]),v._v(" "),t("p",[v._v("从上面的图例可以看出，")]),v._v(" "),t("p",[t("code",[v._v("let name = 'sanyuan'")])]),v._v(" "),t("p",[v._v("这一句话总共在树上被分为四个部分，")]),v._v(" "),t("p",[v._v("转换成树变成了这样的结构：")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://blog-img-1252360401.cos.ap-guangzhou.myqcloud.com/20191209-3.png",alt:"AST示例"}})]),v._v(" "),t("p",[v._v("生成好了 AST 后就已经可以舍弃源代码工作了，")]),v._v(" "),t("p",[v._v("后续只需要使用 AST 还原代码即可。")]),v._v(" "),t("h3",{attrs:{id:"生成字节码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成字节码","aria-hidden":"true"}},[v._v("#")]),v._v(" 生成字节码 🎏")]),v._v(" "),t("p",[v._v("虽然文档和各路文章都使用的是生成机器码(machine code)，")]),v._v(" "),t("p",[v._v("但其实 V8 生成的是汇编代码，")]),v._v(" "),t("p",[v._v("也可将其喊作字节码。")]),v._v(" "),t("p",[v._v("所谓汇编/字节码，其实是介于机器码和高级语言之间的一种代码，")]),v._v(" "),t("p",[v._v("它的编译速度够快，")]),v._v(" "),t("p",[v._v("而且足够灵活。")]),v._v(" "),t("p",[v._v("使用字节码不用一次性全部转换成机器码，")]),v._v(" "),t("p",[v._v("而是通过解释器来逐行执行代码，")]),v._v(" "),t("p",[v._v("省去了生成二进制文件的操作，")]),v._v(" "),t("p",[v._v("这就大大降低了内存的压力。")]),v._v(" "),t("p",[t("img",{attrs:{src:"https://blog-img-1252360401.cos.ap-guangzhou.myqcloud.com/20191209-4.jpg",alt:"源码、字节码、机器码对比"}})]),v._v(" "),t("h3",{attrs:{id:"执行关键点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行关键点","aria-hidden":"true"}},[v._v("#")]),v._v(" 执行关键点 🎏")]),v._v(" "),t("p",[v._v("V8 可以正常顺利的执行，")]),v._v(" "),t("p",[v._v("一定程度上依靠的是特点关键点的定向优化策略：")]),v._v(" "),t("ul",[t("li",[v._v("⭐️ 如果函数没有调用，则 V8 不会去编译它。")]),v._v(" "),t("li",[v._v("⭐️ 如果函数只被调用一次，则 "),t("code",[v._v("解释器（ignition）")]),v._v("将其编译 "),t("code",[v._v("Bytecode")]),v._v(" 就直接解释执行了。")]),v._v(" "),t("li",[v._v("⭐️ 如果函数被调用多次，则这个函数会被识别为 "),t("code",[v._v("热点函数（HotSpot）")]),v._v("，且 "),t("code",[v._v("ignition")]),v._v(" 收集的类型信息证明可以优化编译的话这时 "),t("code",[v._v("TurboFan")]),v._v(" 则会将 "),t("code",[v._v("Bytecode")]),v._v(" 编译为 "),t("code",[v._v("Optimized Machine Code")]),v._v("，以提高代码的执行性能。")])]),v._v(" "),t("p",[v._v("最前面的图为我们介绍了 V8 的基本工作流程，")]),v._v(" "),t("p",[v._v("你可能惊诧于从 "),t("code",[v._v("Optimized Machine Code")]),v._v(" 到 "),t("code",[v._v("Bytecode")]),v._v(" 有一条逆向的红线，")]),v._v(" "),t("p",[v._v("文档中这个过程被称为 "),t("code",[v._v("Deoptimization")]),v._v("。")]),v._v(" "),t("p",[v._v("出现这个过程的原因是 "),t("code",[v._v("ignition")]),v._v(" 最开始收集的信息可能是错误的，")]),v._v(" "),t("p",[v._v("例如函数一开始收集的传入参数是 number 类型的，")]),v._v(" "),t("p",[v._v("后面再次调用的时候传入的参数变成一个 string 类型了，")]),v._v(" "),t("p",[v._v("这时当然是错误的需要清除掉相应的缓存了。")]),v._v(" "),t("h3",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[v._v("#")]),v._v(" 参考资料 🎏")]),v._v(" "),t("ul",[t("li",[v._v("https://kiwenlau.com/2019/07/16/how-does-v8-work/")]),v._v(" "),t("li",[v._v("https://juejin.im/post/5dd8b3a851882572f56b578f?utm_source=gold_browser_extension#heading-6")]),v._v(" "),t("li",[v._v("https://zhuanlan.zhihu.com/p/45499141")]),v._v(" "),t("li",[v._v("https://v8.dev/docs")])]),v._v(" "),t("h2",{attrs:{id:"提问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#提问","aria-hidden":"true"}},[v._v("#")]),v._v(" 提问")]),v._v(" "),t("p",[v._v("讲解完了昨天的问题，又到了今天的提问环节啦~")]),v._v(" "),t("h3",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景","aria-hidden":"true"}},[v._v("#")]),v._v(" 背景 🎏")]),v._v(" "),t("p",[v._v("曾几何时，")]),v._v(" "),t("p",[v._v("那时还没有单独的前端的岗位，")]),v._v(" "),t("p",[v._v("江湖上 PHP 是最好的语言的神话尚未破裂。")]),v._v(" "),t("blockquote",[t("p",[v._v("Any application that can be written in JavaScript, will eventually be written in JavaScript.")])]),v._v(" "),t("p",[v._v("在 SPA 应用打开速度越来越慢的时候，")]),v._v(" "),t("p",[v._v("人们开始怀念起了从前的时光，")]),v._v(" "),t("p",[v._v("也就有了 SSR 井喷方案的诞生。")]),v._v(" "),t("h3",{attrs:{id:"今日提问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#今日提问","aria-hidden":"true"}},[v._v("#")]),v._v(" 今日提问 🎏")]),v._v(" "),t("p",[v._v("“须乘醉，雕鞍归去，争看醉颜酡。”")]),v._v(" "),t("hr"),v._v(" "),t("p",[t("strong",[v._v("今天的问题是：")])]),v._v(" "),t("p",[v._v("⭐️ "),t("strong",[v._v("请你谈谈 SSR 的基本流程和优缺点")])])])},[],!1,null,null,null);_.default=e.exports}}]);